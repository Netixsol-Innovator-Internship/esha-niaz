<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>select-quiz</title>

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @font-face {
        font-family: "Inter";
        src: url("/fonts/inter.woff2") format("woff2");
        font-weight: 100 900;
        font-style: normal;
        font-display: swap;
      }
      :root {
        --font-inter: "Inter", ui-sans-serif, system-ui, -apple-system,
          "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans",
          "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
          "Noto Color Emoji";
      }
      .font-inter {
        font-family: var(--font-inter);
      }
    </style>
  </head>
  <body class="font-inter text-neutral-900 overflow-x-hidden antialiased">
    <div class="min-h-dvh overflow-x-hidden bg-white">
      <!-- Page container with max width 1720px  -->
      <header class="border-b bg-white">
        <div
          class="mx-auto w-full max-w-[1280px] px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between gap-4"
        >
          <!-- Brand  -->
          <a href="#" class="flex items-center gap-2 shrink-0">
            <!-- Logo image (use your own src); using a placeholder here  -->
            <!-- <img
              src="images/logo.png"
              alt="QuizMaster logo"
              class="h-5 w-5 rounded"
            /> -->
            <!-- Brand text exactly 18px at all sizes  -->
            <span class="text-[18px] font-semibold tracking-tight"
              >Quiz App</span
            >
          </a>

          <!-- Desktop nav  -->
          <nav
            class="hidden md:flex items-center gap-8 text-sm text-neutral-700"
            aria-label="Main"
          >
            <a href="#" class="hover:text-neutral-900 transition-colors"
              >Home</a
            >
            <a
              href="/myQuizess.html"
              class="hover:text-neutral-900 transition-colors"
              >Quizzes</a
            >
            <a href="#" class="hover:text-neutral-900 transition-colors"
              >Leaderboard</a
            >
            <a
              id="logout-btn-mobile"
              href="#"
              class="hover:text-neutral-900 transition-colors"
              >Log Out</a
            >
            <a href="#" class="hover:text-neutral-900 transition-colors"
              ><img src="images/bell-icon.png" alt=""
            /></a>
            <img
              src="images/sign_upProfile.png"
              alt="User avatar"
              class="h-8 w-8 rounded-full ring-1 ring-neutral-200"
            />
          </nav>

          <!-- Mobile menu (HTML-only with <details>)  -->
          <details class="relative md:hidden">
            <summary
              class="list-none inline-flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm text-neutral-700 hover:bg-neutral-50 cursor-pointer"
            >
              <span class="sr-only">Open menu</span>
              <!-- Simple menu icon using placeholder  -->
              <img src="images/Hamburger_icon.svg.png" alt="" class="h-4 w-4" />
              <!-- Menu -->
            </summary>
            <div
              class="absolute right-0 mt-2 w-48 rounded-md border bg-white shadow-lg p-2 z-50"
            >
              <a
                href="#"
                class="block rounded px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50"
                >Home</a
              >
              <a
                href="/myQuizess.html"
                class="block rounded px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50"
                >Quizzes</a
              >
              <a
                href="#"
                class="block rounded px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50"
                >Leaderboard</a
              >
              <a
                id="logout-btn-mobile"
                href="#"
                class="block rounded px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50"
                >Log Out</a
              >
            </div>
          </details>
        </div>
      </header>

      <!-- Main   -->
      <main class="w-full">
        <section
          class="mx-auto w-full max-w-[960px] px-4 sm:px-6 lg:px-8 py-8 sm:py-10"
        >
          <!-- Profile header  -->
          <div class="flex flex-col items-center text-center">
            <span
              class="inline-flex items-center justify-center rounded-full p-1.5 bg-neutral-100"
            >
              <img
                src="images/main_profile.png"
                alt="Profile avatar"
                class="h-20 w-20 rounded-full object-cover ring-2 ring-white shadow-sm"
              />
            </span>
            <h1 id="profile-name" class="mt-3 text-lg sm:text-xl font-semibold">
              <!-- JS injects name  -->
            </h1>
            <p class="text-xs sm:text-sm text-[#61738A]">Quiz Enthusiast</p>
            <p class="text-[11px] sm:text-xs text-[#61738A]">
              Joined <span id="profile-joined">—</span>
            </p>
          </div>

          <!-- Tabs  -->
          <div class="mt-6">
            <div class="flex items-center gap-6 text-xs sm:text-sm">
              <button
                type="button"
                class="relative pb-3 text-[#61738A] hover:text-neutral-800"
              >
                Activity
              </button>
              <button
                type="button"
                aria-current="page"
                class="relative pb-3 text-neutral-900 font-medium"
              >
                Profile
                <span
                  aria-hidden="true"
                  class="pointer-events-none absolute left-0 right-0 -bottom-[1px] mx-auto h-[2px] w-full bg-[#61738A]"
                ></span>
              </button>
            </div>
            <hr class="mt-2 border-neutral-200" />
          </div>

          <!-- Personal Information  -->
          <section class="mt-6">
            <h2 class="text-lg font-semibold">Personal Information</h2>
            <div
              class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-12 text-[13px]"
            >
              <!-- Left column  -->
              <div class="space-y-6">
                <div class="border-b border-neutral-200 pb-4">
                  <p class="text-neutral-500 text-xs">Name</p>
                  <p id="pi-name" class="mt-1">—</p>
                </div>
                <div class="border-b border-neutral-200 pb-4">
                  <p class="text-neutral-500 text-xs">Bio</p>
                  <p class="mt-1 leading-relaxed">
                    Avid quiz taker and trivia lover. Always up for a challenge!
                  </p>
                </div>
              </div>
              <!-- Right column  -->
              <div class="md:border-l md:pl-12 border-neutral-200">
                <div class="border-b border-neutral-200 pb-4">
                  <p class="text-neutral-500 text-xs">Email</p>
                  <p id="pi-email" class="mt-1">—</p>
                </div>
              </div>
            </div>
          </section>

          <!-- Quiz History  -->
          <section class="mt-8">
            <h2 class="text-lg font-semibold">Quiz History</h2>
            <div
              class="mt-8 overflow-hidden rounded-lg border border-neutral-200"
              role="region"
              aria-label="Quiz history table"
            >
              <table class="w-full text-left text-xs sm:text-sm">
                <thead class="bg-neutral-50 text-black">
                  <tr class="[&>th]:px-4 [&>th]:py-3">
                    <th class="font-medium">Quiz Name</th>
                    <th class="font-medium">Score</th>
                    <th class="font-medium">Date</th>
                  </tr>
                </thead>
                <tbody
                  id="quiz-history-body"
                  class="divide-y text-base/8 divide-neutral-200"
                >
                  <!-- JS injects history rows  -->
                </tbody>
              </table>
            </div>
          </section>
        </section>
      </main>
    </div>
    <!-- Standalone hydration so profile works even on a direct page load  -->
    <script>
      (function () {
        function getCurrentUser() {
          try {
            return JSON.parse(localStorage.getItem("currentUser")) || null;
          } catch {
            return null;
          }
        }
        function getUserResults(email) {
          try {
            return JSON.parse(localStorage.getItem("results:" + email)) || [];
          } catch {
            return [];
          }
        }
        function hydrateStandalone() {
          const user = getCurrentUser();
          const piName = document.getElementById("pi-name");
          const piEmail = document.getElementById("pi-email");
          const profileName = document.getElementById("profile-name");
          const profileJoined = document.getElementById("profile-joined");
          const historyBody = document.getElementById("quiz-history-body");

          if (
            !piName ||
            !piEmail ||
            !profileName ||
            !profileJoined ||
            !historyBody
          )
            return;

          if (!user) {
            alert("Please sign in to view your profile.");
            location.href = "sign_in.html";
            return;
          }

          profileName.textContent = user.fullName || "—";
          piName.textContent = user.fullName || "—";
          piEmail.textContent = user.email || "—";
          profileJoined.textContent = user.joinedAt
            ? new Date(user.joinedAt).toLocaleDateString("en-CA")
            : "—";

          const rows = getUserResults(user.email);
          historyBody.innerHTML = "";
          if (!rows.length) {
            const tr = document.createElement("tr");
            tr.className = "[&>td]:px-4 [&>td]:py-4";
            tr.innerHTML =
              '<td colspan="3" class="text-[#61738A]">No quiz attempts yet.</td>';
            historyBody.appendChild(tr);
          } else {
            rows
              .sort((a, b) => (a.date || "").localeCompare(b.date || ""))
              .reverse()
              .forEach((r) => {
                const tr = document.createElement("tr");
                tr.className = "[&>td]:px-4 [&>td]:py-4";
                const dateStr = r.date
                  ? new Date(r.date).toLocaleDateString("en-CA")
                  : "—";
                tr.innerHTML = `
                <td>${r.quizTitle || r.quizId}</td>
                <td class="text-[#61738A]">${r.score}/${r.total}</td>
                <td class="text-[#61738A]">${dateStr}</td>
              `;
                historyBody.appendChild(tr);
              });
          }
        }

        function wireLogoutButtons() {
          function doLogout() {
            localStorage.removeItem("currentUser");
            alert("Logged out.");
            if (
              typeof window.loadPage === "function" &&
              document.getElementById("app")
            ) {
              window.loadPage("landing_page.html");
            } else {
              // Go back to SPA root; it will render landing_page.html and reattach events
              location.href = "index.html";
            }
          }
          const desktop = document.getElementById("logout-btn");
          const mobile = document.getElementById("logout-btn-mobile");
          if (desktop)
            desktop.addEventListener("click", function (e) {
              e.preventDefault();
              doLogout();
            });
          if (mobile)
            mobile.addEventListener("click", function (e) {
              e.preventDefault();
              doLogout();
            });
        }

        document.addEventListener("DOMContentLoaded", function () {
          // If the SPA hydrate function exists, use it; else run standalone hydrator
          const piName = document.getElementById("pi-name");
          const piEmail = document.getElementById("pi-email");
          const profileName = document.getElementById("profile-name");
          const profileJoined = document.getElementById("profile-joined");
          const historyBody = document.getElementById("quiz-history-body");

          if (typeof window.hydrateProfilePage === "function") {
            window.hydrateProfilePage({
              piName,
              piEmail,
              profileName,
              profileJoined,
              historyBody,
            });
          } else {
            hydrateStandalone();
          }
          wireLogoutButtons();
        });
      })();
    </script>
  </body>
</html>
